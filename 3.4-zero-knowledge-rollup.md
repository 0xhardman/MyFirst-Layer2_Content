# 3.4 Zero-Knowledge Rollup

造成漫长等待期的原因，就是因为OP-Rollup需要人的参与（挑战者扮演的角色），要是能让整个过程不需要人的参与，仅仅有算法的参与就完美了。

是否有一种神奇的算法，让在Layer2诚实执行交易的验证者能生成一个证明，而不诚实的验证者完全无法得到正确的证明，并且Layer1验证这个证明的代价极低？

这样Layer1确认了证明之后，就能认可一整个批次的交易为真，若证明无法通过则拒绝整个批次的打包。

Too good to be true?

幸运的是，数学上这样的证明是存在的，它就是零知识证明。

### 什么是零知识证明

零知识证明是指向他人证明某个命题为真，但又不透露“该命题为真”之外的其他任何信息。 如：有一个环形的长廊，在走廊中间某处有一道安装了密码锁的门，若A要向B证明自己拥有该门的密码，无需向B展示自己打开密码锁的过程。只需要让B看着A从入口进入走廊，然后又从另一侧的出口走出走廊，就完全可以证明A拥有钥匙。

![【零知识证明静态图】](https://www.notion.so/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fc930e69b-2e17-4f8e-978f-d4569ffe02a0%2FUntitled.png?id=af0c487d-2c24-4a46-a9cb-8c02d2f12e3a\&table=block\&spaceId=b1dd17ad-aa83-4faf-9395-5329c519d830\&width=2000\&userId=e298088e-2c93-42ed-870b-b44d950d1eae\&cache=v2)

零知识证明具备以下性质：

1. 完备性（Completeness）：若命题为真，任何证明者可以向验证者提出令人信服的证据，即“真的可被验证”。
2. 可靠性（Soundness）：若命题为假，则不存在不诚实的证明者能骗过验证者，即“假的会被发现”。
3. 零知识（Zero Knowledge）：证明某个命题为真，但又不透露“该命题为真”之外的其他任何信息。

工程上我们还强调零知识证明的算法拥有：

1. 简洁性（Succinctness）：验证计算被正确执行的代价要远小于重新计算的代价。
2. 可靠性（Zero Knowledge）：可以隐藏计算的输入信息。

### ZK-Rollup

有了神奇的零知识证明，我们就可以上传更少的数据到Layer1，从而进一步实现扩容并降低交易成本。

ZK-Rollup会周期性向主网上传3种数据：

* 状态根：状态根可以快速确认Layer2小账本的内容是否被篡改。
* 交易数据：经过压缩后的交易数据，比如将一连串的交易压缩为状态变化的结果。特别是因为使用零知识证明保证安全性，所以可以舍弃“用户签名”等不必要的信息。
* 有效性证明：即零知识证明，让Layer1的智能合约在经过简单验证后，就能确认交易已经被正确执行。



![【3.4.2 ZK链式动图 （SC小细节待讨论） 】或者动效](https://www.notion.so/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa0a84648-8c0a-42b8-97d7-f654fb9a4b98%2FUntitled.png?id=fd01bc06-1a15-4ddf-bea8-fabf2717ac36\&table=block\&spaceId=b1dd17ad-aa83-4faf-9395-5329c519d830\&width=2000\&userId=e298088e-2c93-42ed-870b-b44d950d1eae\&cache=v2)

与OP-Rollup依赖挑战者不同，ZK-Rollup方案中Layer1的智能合约能用很小的代价检验ZK Proof的有效性，如果检验通过则表示这批交易已经被正确执行，那就更新状态。如果检验不通过，则拒绝这一批次的交易。

ZK-Rollup的优点显而易见：

* 更高的压缩率，让Layer2的交易成本更低，扩容的上限更高。
* 依靠数学而非验证者，安全性更有保障，并且确认时间非常短。

但它之所以没有快速普及，就是因为技术难度太大，对EVM的兼容性较差。**为什么零知识证明会这么难呢**？
